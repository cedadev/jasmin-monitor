<!DOCTYPE HTML>
<html>

<head>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.3/jquery.min.js"></script>
    <link rel="stylesheet" href="//code.jquery.com/ui/1.11.4/themes/smoothness/jquery-ui.css">
    <script src="//cdnjs.cloudflare.com/ajax/libs/dygraph/1.1.1/dygraph-combined.js"></script>
    <script src="//code.jquery.com/jquery-1.10.2.js"></script>
    <script src="//code.jquery.com/ui/1.11.4/jquery-ui.js"></script>
    <link rel="stylesheet" href="/resources/demos/style.css">


    <style>
        #header {
            background-color: black;
            color: white;
            text-align: center;
            padding: 5px;
        }
        
        section {
            width: 1000px;
            float: left;
            padding: 10px;
        }
        
        nav {
            line-height: 30px;
            background-color: #eeeeee;
            height: 1000px;
            width: 300px;
            float: left;
            padding: 5px;
        }
        
        ul {
            list-style-type: none;
            margin: 0;
            padding: 0;
        }
        
        li {
            display: inline;
        }
    </style>

    <div id="header">
        <h1> Resource Monitoring System </h1>
    </div>

    <body>
        <nav>
            <p><b> Enter Metric Type</b></p>
            <p>Type:
		<select name="metric" id="metric_type" style="width: 200px">
		  <option value="----">--Select--</option>
		  <option value="CPU">CPU</option>
		  <option value="RAM">RAM</option>
		</select>
            </p>
            <p><b> Enter Dates</b></p>
            <p>Start Date:
                <input type="text" id="datepicker_start">
            </p>
            <p>End Date:
                <input type="text" id="datepicker_end">
            </p>
            <input type="button" id="filterBtn" value="Update" />
        </nav>
        <ul>
	    <li><button onclick="location.href = '/month';" id="week">Month</button></li>
	    <li><button onclick="location.href = '/year';" id="week">Year</button></li>
	    <li><button onclick="location.href = '/';" id="week"submit-button" >Home</button></li>
        </ul>
        <section>
	    <div id="graphdiv" style="height: 750px; width: 150%;"></div>
            <script type="text/javascript">
                $('#datepicker_start').datepicker(
                {
                    dateFormat: 'yy-mm-dd',
                    onSelect: function(selected)
                    {
                        $("#datepicker_start").datepicker();

                    }
                });
                $('#datepicker_end').datepicker(
                {
                    dateFormat: 'yy-mm-dd',
                    onSelect: function(selected)
                    {
                        $("#datepicker_end").datepicker();
                    }
                });
            </script>


            <script type="text/javascript">
                $("#filterBtn").click(function()
                {
		    var dataPoints = [];
                    var type = document.getElementById("metric_type").value;
                    var x = document.getElementById("datepicker_start").value;
                    var y = document.getElementById("datepicker_end").value;
                    $.ajax(
                    {
                        type: "GET",
                        url: "api/cpu/month",
                        data:
                        {
                            'metric_type': type,
                            'start': x,
                            'end': y
                        },
                        dataType: 'json',
                        success: function(data)
                        {
                            console.log(data);

                            

                            $.each(data, function(index, element)
                            {
			       xval = element.day
                               yval = element.value
				var reggie = /(\d{4})-(\d{2})-(\d{2})/
				var dateArray = reggie.exec(xval)
				var dateObject = new Date(
				    (+dateArray[1]),
				    (+dateArray[2])-1, // Careful, month starts at 0!
				    (+dateArray[3])
				);
	

				//var newtime = dateObject.toISOString()
				// var collected_time = newtime
                                // var parse_time = collected_time.substring(0, 19);
                                // var new_collected_time = parse_time.split("T").join(" ")
				//alert(new_collected_time)

			       var x = [new Date(dateObject),yval]
			       dataPoints.push(x);
                            });


				  g = new Dygraph(

				    // containing div
				    document.getElementById("graphdiv"),dataPoints,
		                 {

		                    drawPoints: true,
		                    showRoller: true,
		                    labels: ['Date Time', 'Total']
				}

				  );


                        }
                    }).fail(function()
                    {
                        alert('ERROR! \nAre the dates entered in the correct format ("YYYY-mm-dd")');
                    });
                });
            </script>
        </section>
    </body>
</html>
